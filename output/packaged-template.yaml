AWSTemplateFormatVersion: 2010-09-09
Description: Resources to be created by the common stack
Parameters:
  pApplicationName:
    Description: Name of the application (all lowercase, no symbols or spaces)
    Type: String
    AllowedPattern: '[a-z0-9]{2,8}'
    Default: datalake
  pEnvironment:
    Description: Environment name
    AllowedValues:
    - dev
    - test
    - prod
    Type: String
    Default: dev
  pOrganizationName:
    Description: Name of the organization (all lowercase, no symbols or spaces)
    Type: String
    AllowedPattern: '[a-z0-9]{2,9}'
  pCustomBucketPrefix:
    Description: S3 Bucket Prefix if different from default. Must be a valid S3 Bucket
      name
    Type: String
    Default: sdlf
  pDatasetBucket:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /Master/S3/CentralBucket
    Description: S3 Raw Bucket
  pStageBucket:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /Master/S3/StageBucket
    Description: S3 Stage Bucket
  pAnalyticsBucket:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /Master/S3/AnalyticsBucket
    Description: S3 Analytics Bucket
Resources:
  rS3Stack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.amazonaws.com/sdlf-cfn-artifacts-us-east-1-829547505377/soccer/b78746fe47594df57b6091cb0ff7859d.template
      Parameters:
        pApplicationName:
          Ref: pApplicationName
        pCustomBucketPrefix:
          Ref: pCustomBucketPrefix
        pEnvironment:
          Ref: pEnvironment
        pOrganizationName:
          Ref: pOrganizationName
      Tags:
      - Key: tagging-policy
        Value:
          Fn::Sub: ${pOrganizationName}-${pApplicationName}-${pEnvironment}-storage
    Metadata:
      SamResourceId: rS3Stack
  rProcessStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: https://s3.amazonaws.com/sdlf-cfn-artifacts-us-east-1-829547505377/soccer/5c9cf2070e9c9bd9d6ad91a22793eb7b.template
      Parameters:
        pDatasetBucket:
          Ref: pDatasetBucket
        pAnalyticsBucket:
          Ref: pAnalyticsBucket
        pStageBucket:
          Ref: pStageBucket
      Tags:
      - Key: tagging-policy
        Value:
          Fn::Sub: ${pOrganizationName}-${pApplicationName}-${pEnvironment}-processing
    Metadata:
      SamResourceId: rProcessStack
